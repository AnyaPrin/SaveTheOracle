<!DOCTYPE html>
<html lang="ja">
  <head>
    <style>
      body { margin: 0;
	     background:#888;}
      canvas { display: block; }
    </style>
    3DViewer: Mouse Control and Local libraries TEST
    <script src="lib/three.min.js"></script>
    <script src="lib/GLTFLoader.js"></script>
    <script src="lib/OrbitControls.js"></script>
    
  </head>
  <body>    
    <script>
      // 呪文の詠唱
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 2.5;
      
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);

      document.body.appendChild(renderer.domElement);
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
      directionalLight.position.set(0, 1, 1);
      scene.add(directionalLight);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true; 
      controls.dampingFactor = 0.05;
      controls.screenSpacePanning = false;
      controls.minDistance = 2; 
      controls.maxDistance = 10;
      
      /** GLTF Loader instance */
      const loader = new THREE.GLTFLoader();
      loader.load(
	  'obj/Gaia_node.glb',
          function (gltf) {
	      const model = gltf.scene;
	      scene.add(model);	      	      	      
              model.scale.set(1, 1, 1);
	      model.position.set(0, -1.2, 0);
	      model.traverse((child)=> {
		  if (child.isMesh) {
		      child.material.transparent = true;
		      child.material.opacity = 0.5;
		      child.material.needsUpdate = true;
		  }
	      });
	  },
	  function (xhr) {
	      console.log((xhr.loaded / xhr.total * 100) + '% loaded');
          },
          function (error) {
	      console.error('An error happened:', error);
          });
      
      window.addEventListener('resize', () => {
	  camera.aspect = window.innerWidth / window.innerHeight;
	  camera.updateProjectionMatrix();
	  renderer.setSize(window.innerWidth, window.innerHeight);
      });
      function animate() {                         // アニメーションループ
	  requestAnimationFrame(animate);
	  controls.update();                       // カメラコントロールの更新
	  if (scene.children.length > 0) {         // モデルを回転
              scene.children.forEach(child => {
		  if (child.isMesh || child.isGroup) {
                      child.rotation.y += 0.01;
		  }
              });
	  }
	  renderer.render(scene, camera);
      }
      animate();
    </script>

    </body>
    </html>
